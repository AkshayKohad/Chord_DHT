syntax = "proto3";

package chord;

message Empty {}

message NodeInfo {
  string id = 1;
  string address = 2;
  int32 port = 3;
}

message FingerEntry {
  int32 start = 1;
  NodeInfo node = 2;
}

message FingerTableResponse {
  repeated FingerEntry entries = 1;
}

message LookupRequest {
  string key = 1;
}

message LookupResponse {
  NodeInfo node = 1;
}

message JoinRequest {
  NodeInfo new_node = 1;
  string known_node_address = 2;
  int32 known_node_port = 3;
}

message JoinResponse {
  NodeInfo successor = 1;
}

message NotifyRequest {
  NodeInfo node = 1;
}

message NotifyResponse {
  bool accepted = 1;
}

message PutRequest {
  string key = 1;
  string value = 2;
  bool is_replica = 3;
}

message PutResponse {
  bool success = 1;
  string message = 2;
}

message GetRequest {
  string key = 1;
}

message GetResponse {
  bool found = 1;
  string value = 2;
}

message DeleteRequest {
  string key = 1;
  bool is_replica = 2;
}

message DeleteResponse {
  bool success = 1;
  string message = 2;
}

message SuccessorListResponse {
  repeated NodeInfo successors = 1;
}

// New messages for the update functionality.
message UpdateRequest {
  string key = 1;
  string new_value = 2;
  bool is_replica = 3;
}

message UpdateResponse {
  bool success = 1;
  string message = 2;
}


service ChordService {
  rpc FindSuccessor(LookupRequest) returns (LookupResponse);
  rpc Join(JoinRequest) returns (JoinResponse);
  rpc Notify(NotifyRequest) returns (NotifyResponse);
  rpc PutData(PutRequest) returns (PutResponse);
  rpc GetData(GetRequest) returns (GetResponse);
  rpc DeleteData(DeleteRequest) returns (DeleteResponse);
  rpc GetSuccessorList(Empty) returns (SuccessorListResponse);
  rpc GetFingerTable(Empty) returns (FingerTableResponse);
  // New RPC to update a key's value on nodes where the data is stored.
  rpc UpdateData(UpdateRequest)         returns (UpdateResponse);
}
